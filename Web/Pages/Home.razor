@page "/"
@using Microsoft.AspNetCore.Components.Authorization
@inject AuthenticationStateProvider AuthStateProvider
@inject IDataSerializer? DataSerializer
@using OfficeProject.Models.DTO
@using OfficeProject.Models.Enums

<AuthorizeView>
    <Authorized>
        <PageTitle>Dashboard</PageTitle>

        <div class="container-fluid py-4">
            <!-- Welcome Header -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-body d-flex justify-content-between align-items-center">
                            <div>
                                <h1 class="h3 mb-1">Welcome back, @(userName ?? "User")!</h1>
                                <p class="text-muted mb-0">Here's what's happening today</p>
                            </div>
                            <div class="text-end">
                                <span class="badge bg-primary">@DateTime.Now.ToString("dddd, MMMM dd")</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Key Metrics -->

            <div class="row mb-4">
                <div class="col-md-6 mb-4">
                    <div class="card bg-primary text-white h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-uppercase text-white-50 small">Tasks</h6>

                                    @if (dayLeftList.Count >= 2)
                                    {
                                        <div>
                                            <div><strong>@GetDayLabel(dayLeftList[0])</strong></div>
                                            <div>Posts: @FirstMinPost</div>
                                            <div>Reels: @FirstMinReels</div>
                                            <div>Backlinks: @FirstMinBacklink</div>
                                            <div>Classified: @FirstMinClassified</div>
                                            <div>Social Sharing: @FirstMinSocialSharing</div>
                                            <hr />
                                            <div><strong>@GetDayLabel(dayLeftList[1])</strong></div>
                                            <div>Posts: @SecondMinPost</div>
                                            <div>Reels: @SecondMinReels</div>
                                            <div>Backlinks: @SecondMinBacklink</div>
                                            <div>Classified: @SecondMinClassified</div>
                                            <div>Social Sharing: @SecondMinSocialSharing</div>
                                        </div>
                                    }
                                    else if (dayLeftList.Count == 1)
                                    {
                                        <div>
                                            <div><strong>@GetDayLabel(dayLeftList[0])</strong></div>
                                            <div>Posts: @FirstMinPost</div>
                                            <div>Reels: @FirstMinReels</div>
                                            <div>Backlinks: @FirstMinBacklink</div>
                                            <div>Classified: @FirstMinClassified</div>
                                            <div>Social Sharing: @FirstMinSocialSharing</div>
                                        </div>
                                    }
                                    else
                                    {
                                        <div>No tasks available.</div>
                                    }
                                </div>
                                <i class="fas fa-tasks fa-2x opacity-50"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-md-6 mb-4">
                    <div class="card shadow-sm rounded-4 border-0">
                        <div class="card-header bg-white border-0 d-flex justify-content-between align-items-center">
                            <h5 class="mb-0 text-primary fw-semibold">Performance Overview</h5>
                            <i class="fas fa-tachometer-alt text-muted"></i>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>Post</span>
                                    <span class="badge bg-success">@CompletionPostRate%</span>
                                </div>
                                <div class="progress" style="height: 6px;">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: @CompletionPostRate%;" aria-valuenow="@CompletionPostRate" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>Reel</span>
                                    <span class="badge bg-info text-dark">@CompletionReelsRate%</span>
                                </div>
                                <div class="progress" style="height: 6px;">
                                    <div class="progress-bar bg-info" role="progressbar" style="width: @CompletionReelsRate%;" aria-valuenow="@CompletionReelsRate" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>Backlink</span>
                                    <span class="badge bg-primary">@CompletionBacklinkRate%</span>
                                </div>
                                <div class="progress" style="height: 6px;">
                                    <div class="progress-bar bg-primary" role="progressbar" style="width: @CompletionBacklinkRate%;" aria-valuenow="@CompletionBacklinkRate" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>

                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>Classified</span>
                                    <span class="badge bg-warning text-dark">@CompletionClassifiedRate%</span>
                                </div>
                                <div class="progress" style="height: 6px;">
                                    <div class="progress-bar bg-warning" role="progressbar" style="width: @CompletionClassifiedRate%;" aria-valuenow="@CompletionClassifiedRate" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>

                            <div>
                                <div class="d-flex justify-content-between">
                                    <span>Social Sharing</span>
                                    <span class="badge bg-danger">@CompletionSocialSharingRate%</span>
                                </div>
                                <div class="progress" style="height: 6px;">
                                    <div class="progress-bar bg-danger" role="progressbar" style="width: @CompletionSocialSharingRate%;" aria-valuenow="@CompletionSocialSharingRate" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div>

               @*  <div class="col-md-3 mb-3 mb-md-0">
                    <div class="card bg-success text-white h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-uppercase text-white-50 small">Projects &amp;&amp; Services</h6>
                                </div>
                                <i class="fas fa-project-diagram fa-2x opacity-50"></i>
                            </div>
                            <div class="mt-3">
                                <div>Projects - @TotalProject</div>
                                <br />
                                <div>Services - @TotalService</div>
                            </div>
                        </div>
                    </div>
                </div>
              

                <div class="col-md-3">
                    <div class="card bg-warning text-dark h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="text-uppercase text-dark-50 small">Upcoming</h6>
                                    <h2 class="mb-0">3</h2>
                                </div>
                                <i class="fas fa-calendar-alt fa-2x opacity-50"></i>
                            </div>
                            <div class="mt-3">
                                <span class="text-dark-50 small">Meetings today</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div> *@

            <!-- Quick Actions & Recent Activity -->
            @* <div class="row">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-white border-bottom">
                            <h5 class="mb-0">Quick Actions</h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-6">
                                    <button class="btn btn-outline-primary w-100 py-3">
                                        <i class="fas fa-plus me-2"></i> New Task
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button class="btn btn-outline-success w-100 py-3">
                                        <i class="fas fa-file-alt me-2"></i> Create Report
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button class="btn btn-outline-info w-100 py-3">
                                        <i class="fas fa-users me-2"></i> Add Team
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button class="btn btn-outline-warning w-100 py-3">
                                        <i class="fas fa-calendar-plus me-2"></i> Schedule
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="col-lg-6">
                    <div class="card shadow-sm h-100">
                        <div class="card-header bg-white border-bottom">
                            <h5 class="mb-0">Recent Activity</h5>
                        </div>
                        <div class="card-body p-0">
                            <ul class="list-group list-group-flush">
                                <li class="list-group-item border-0">
                                    <div class="d-flex">
                                        <div class="flex-shrink-0 text-success">
                                            <i class="fas fa-check-circle"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <small class="text-muted float-end">10 min ago</small>
                                            <h6 class="mb-1">Task completed</h6>
                                            <p class="mb-0 small">Project kickoff presentation</p>
                                        </div>
                                    </div>
                                </li>
                                <li class="list-group-item border-0">
                                    <div class="d-flex">
                                        <div class="flex-shrink-0 text-primary">
                                            <i class="fas fa-comment-alt"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <small class="text-muted float-end">25 min ago</small>
                                            <h6 class="mb-1">New comment</h6>
                                            <p class="mb-0 small">On Q2 financial report</p>
                                        </div>
                                    </div>
                                </li>
                                <li class="list-group-item border-0">
                                    <div class="d-flex">
                                        <div class="flex-shrink-0 text-warning">
                                            <i class="fas fa-calendar-check"></i>
                                        </div>
                                        <div class="flex-grow-1 ms-3">
                                            <small class="text-muted float-end">1 hour ago</small>
                                            <h6 class="mb-1">Meeting scheduled</h6>
                                            <p class="mb-0 small">Client review at 2:00 PM</p>
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div> *@

            <!-- Recent Projects -->
           @*  <div class="row mt-4">
                <div class="col-12">
                    <div class="card shadow-sm">
                        <div class="card-header bg-white border-bottom">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">Recent Projects</h5>
                                <a href="#" class="btn btn-sm btn-outline-primary">View All</a>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>Project</th>
                                            <th>Team</th>
                                            <th>Status</th>
                                            <th>Progress</th>
                                            <th>Deadline</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Website Redesign</td>
                                            <td>
                                                <div class="avatar-group">
                                                    <span class="avatar avatar-sm rounded-circle bg-primary text-white">JD</span>
                                                    <span class="avatar avatar-sm rounded-circle bg-success text-white">AM</span>
                                                    <span class="avatar avatar-sm rounded-circle bg-info text-white">+2</span>
                                                </div>
                                            </td>
                                            <td><span class="badge bg-warning">In Progress</span></td>
                                            <td>
                                                <div class="progress" style="height: 6px;">
                                                    <div class="progress-bar bg-warning" role="progressbar" style="width: 65%"></div>
                                                </div>
                                            </td>
                                            <td>May 15</td>
                                        </tr>
                                        <tr>
                                            <td>Mobile App Development</td>
                                            <td>
                                                <div class="avatar-group">
                                                    <span class="avatar avatar-sm rounded-circle bg-danger text-white">SK</span>
                                                    <span class="avatar avatar-sm rounded-circle bg-info text-white">+3</span>
                                                </div>
                                            </td>
                                            <td><span class="badge bg-success">Completed</span></td>
                                            <td>
                                                <div class="progress" style="height: 6px;">
                                                    <div class="progress-bar bg-success" role="progressbar" style="width: 100%"></div>
                                                </div>
                                            </td>
                                            <td>Apr 28</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div> *@
        </div>


    </Authorized>
    <NotAuthorized>
        @{
            Navigation.NavigateTo("/login", replace: true);
        }
    </NotAuthorized>
</AuthorizeView>
@code {
    private string? userName;
    private bool loadFailed = false;
    private bool isLoading = true;
    private List<ProjectsDTO> projects = new();
    private int SecondMinPost { get; set; }
    private int SecondMinReels { get; set; }
    private int SecondMinBacklink { get; set; }
    private int SecondMinClassified { get; set; }
    private int SecondMinSocialSharing { get; set; }

    private int FirstMinPost { get; set; }
    private int TotalProject { get; set; }
    private int TotalService { get; set; }
    private int FirstMinReels { get; set; }
    private int FirstMinBacklink { get; set; }
    private int FirstMinClassified { get; set; }
    private int FirstMinSocialSharing { get; set; }


    private double CompletionPostRate { get; set; }
    private double CompletionReelsRate { get; set; }
    private double CompletionBacklinkRate { get; set; }
    private double CompletionClassifiedRate { get; set; }
    private double CompletionSocialSharingRate { get; set; }
    

    [Inject] private DateService? DateService { get; set; }


    [Inject] private NavigationManager Navigation { get; set; } = null!;
    [Inject] private ApiService api { get; set; } = null!;

    private List<int> dayLeftList = new();

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        userName = authState.User.Identity?.Name;
        isLoading = true;
        await GetProjectPerUserAsync();
        isLoading = false;
    }
    



    protected async Task GetProjectPerUserAsync()
    {
        try
        {
            projects = await api.GetProjectPerUserAsync();
            GetTodayTerget();
            // Optional: Check if the first project has no services
            if (projects.Count > 0 && (projects[0].Services == null || projects[0].Services!.Count == 0))
            {
                projects.Clear(); // Or assign new List<ProjectsDTO>() again if preferred
            }

            // Optional: serialize if needed
            // DataSerializer.Serializer(projects, "ToDayWorkList:GetProjectPerUserAsync");
        }
        catch (Exception ex)
        {
            loadFailed = true;
            Console.WriteLine($"Error loading projects: {ex.Message}");
        }
    }

    private void GetTodayTerget()
    {
        foreach (var project in projects)
        {
            if (project.Services != null && project.Services.Any())
            {
                TotalProject += 1;
                foreach (var service in project.Services)
                {
                    TotalService += 1;



                    var postProgress = GetWorkProgressColor(service, (int)service.TotalPost!, service.StartDate, (int)service.CompletePost!);
                    service.DayLeft = postProgress.DaysLeft;

                    var postRequired = GetWorkProgressColor(service, (int)service.TotalPost!, service.StartDate, (int)service.CompletePost!);
                    service.RequiredPost = postRequired.RequiredUnit;

                    var reelProgress = GetWorkProgressColor(service, (int)service.TotalReels!, service.StartDate, (int)service.CompleteReels!);
                    service.DayLeft = reelProgress.DaysLeft;

                    var reelRequired = GetWorkProgressColor(service, (int)service.TotalReels!, service.StartDate, (int)service.CompleteReels!);
                    service.RequiredReels = reelRequired.RequiredUnit;

                    var backlinkProgress = GetWorkProgressColor(service, (int)service.Backlink!, service.StartDate, (int)service.CompleteBacklink!);
                    service.DayLeft = backlinkProgress.DaysLeft;

                    var backlinkRequired = GetWorkProgressColor(service, (int)service.Backlink!, service.StartDate, (int)service.CompleteBacklink!);
                    service.RequiredBacklink = backlinkRequired.RequiredUnit;

                    var clasifiedProgress = GetWorkProgressColor(service, (int)service.Clasified!, service.StartDate, (int)service.CompleteClasified!);
                    service.DayLeft = clasifiedProgress.DaysLeft;

                    var clasifiedRequired = GetWorkProgressColor(service, (int)service.Clasified!, service.StartDate, (int)service.CompleteClasified!);
                    service.RequiredClasified = clasifiedRequired.RequiredUnit;

                    var socilSharingProgress = GetWorkProgressColor(service, (int)service.SocialSharing!, service.StartDate, (int)service.CompleteSocialSharing!);
                    service.DayLeft = socilSharingProgress.DaysLeft;

                    var socilSharingRequired = GetWorkProgressColor(service, (int)service.SocialSharing!, service.StartDate, (int)service.CompleteSocialSharing!);
                    service.RequiredSocialSharing = socilSharingRequired.RequiredUnit;


                }
            }
        }
        GetFirstMinDaySecondMinDay();
        AvgCalculation();

    }
    private void AvgCalculation()
    {
        int CompletePost = 0;
        int CompleteReels = 0;
        int CompleteBacklink = 0;
        int CompleteClassified = 0;
        int CompleteSocialSharing = 0;

        int TergetPost = 0;
        int TergetReels = 0;
        int TergetBacklink = 0;
        int TergetClassified = 0;
        int TergetSocialSharing = 0;

        double SumIntervalDays = 0;
        int TotalProject = 0;

        foreach (var project in projects)
        {
            if (project.Services != null && project.Services.Any())
            {
                TotalProject += 1;

                foreach (var service in project.Services)
                {
                    int intervalDays = DateService!.GetTotalDaysFromTodayExcludingSundays(service.StartDate);
                    SumIntervalDays += intervalDays;

                    int complete = service.CompletePost ?? 0;
                    int target = service.TotalPost;

                    CompletePost += complete;
                    TergetPost += target;

                    Console.WriteLine("IntervalDate - " + intervalDays);
                }
            }
        }

        double AvgCompletePost = SumIntervalDays > 0 ? (double)CompletePost / SumIntervalDays : 0;
        double AvgTergetPost = SumIntervalDays > 0 ? (double)TergetPost / SumIntervalDays : 0;

        double AvgCompleteReels = SumIntervalDays > 0 ? (double)CompleteReels / SumIntervalDays : 0;
        double AvgTergetReels = SumIntervalDays > 0 ? (double)TergetReels / SumIntervalDays : 0;

        double AvgCompleteBacklink = SumIntervalDays > 0 ? (double)CompleteBacklink / SumIntervalDays : 0;
        double AvgTergetBacklink = SumIntervalDays > 0 ? (double)TergetBacklink / SumIntervalDays : 0;

        double AvgCompleteClassified = SumIntervalDays > 0 ? (double)CompleteClassified / SumIntervalDays : 0;
        double AvgTergetClassified = SumIntervalDays > 0 ? (double)TergetClassified / SumIntervalDays : 0;

        double AvgCompleteSocialSharing = SumIntervalDays > 0 ? (double)CompleteSocialSharing / SumIntervalDays : 0;
        double AvgTergetSocialSharing = SumIntervalDays > 0 ? (double)TergetSocialSharing / SumIntervalDays : 0;

        // Compute completion percentage relative to AvgTargetPost
        CompletionPostRate = AvgTergetPost > 0 ? (AvgCompletePost / AvgTergetPost) * 100 : 0;

        // Compute completion percentage relative to AvgTargetReels
        CompletionReelsRate = AvgTergetReels > 0 ? (AvgCompleteReels / AvgTergetReels) * 100 : 0;

        // Compute completion percentage relative to AvgTargetClassified
        CompletionClassifiedRate = AvgTergetBacklink > 0 ? (AvgCompleteBacklink / AvgTergetBacklink) * 100 : 0;

        // Compute completion percentage relative to AvgTargetClassified
        CompletionClassifiedRate = AvgTergetClassified > 0 ? (AvgCompleteClassified / AvgTergetClassified) * 100 : 0;

        // Compute completion percentage relative to AvgTargetSocialSharing
        CompletionSocialSharingRate = AvgTergetSocialSharing > 0 ? (AvgCompleteSocialSharing / AvgTergetSocialSharing) * 100 : 0;





        // Console.WriteLine("CompletePost - " + CompletePost);
        // Console.WriteLine("TergetPost - " + TergetPost);
        // Console.WriteLine("SumIntervalDays - " + SumIntervalDays);
        // Console.WriteLine("AvgCompletePost - " + AvgCompletePost);
        // Console.WriteLine("AvgTergetPost - " + AvgTergetPost);
        // Console.WriteLine("Completion Rate - " + Math.Round(CompletionPostRate, 2) + "%");
        // Console.WriteLine("Completion Rate - " + Math.Round(CompletionReelsRate, 2) + "%");
        // Console.WriteLine("Completion Rate - " + Math.Round(CompletionBacklinkRate, 2) + "%");
        // Console.WriteLine("Completion Rate - " + Math.Round(CompletionClassifiedRate, 2) + "%");
        // Console.WriteLine("Completion Rate - " + Math.Round(CompletionSocialSharingRate, 2) + "%");
    }

    private void GetFirstMinDaySecondMinDay()
    {
        var allServices = projects
            .Where(p => p.Services != null)
            .SelectMany(p => p.Services!)
            .Where(s => s.DayLeft.HasValue)
            .ToList();

        dayLeftList = allServices
           .Select(s => s.DayLeft!.Value)
           .Distinct()
           .OrderBy(x => x)
           .ToList();

        if (dayLeftList.Count >= 2)
        {
            int firstMin = dayLeftList[0];
            int secondMin = dayLeftList[1];

            // Console.WriteLine($"First Min: {firstMin}, Second Min: {secondMin}");

            //  firstMin

            FirstMinPost = allServices
     .Where(s => s.DayLeft == firstMin)
     .Sum(s => s.RequiredPost ?? 0);

            FirstMinReels = allServices
                .Where(s => s.DayLeft == firstMin)
                .Sum(s => s.RequiredReels ?? 0);

            FirstMinBacklink = allServices
                .Where(s => s.DayLeft == firstMin)
                .Sum(s => s.RequiredBacklink ?? 0);

            FirstMinClassified = allServices
                .Where(s => s.DayLeft == firstMin)
                .Sum(s => s.RequiredClasified ?? 0);

            FirstMinSocialSharing = allServices
                .Where(s => s.DayLeft == firstMin)
                .Sum(s => s.RequiredSocialSharing ?? 0);

            //secondMin


            SecondMinPost = allServices
     .Where(s => s.DayLeft == secondMin)
     .Sum(s => s.RequiredPost ?? 0);

            SecondMinReels = allServices
                .Where(s => s.DayLeft == secondMin)
                .Sum(s => s.RequiredReels ?? 0);

            SecondMinBacklink = allServices
                .Where(s => s.DayLeft == secondMin)
                .Sum(s => s.RequiredBacklink ?? 0);

            SecondMinClassified = allServices
                .Where(s => s.DayLeft == secondMin)
                .Sum(s => s.RequiredClasified ?? 0);

            SecondMinSocialSharing = allServices
                .Where(s => s.DayLeft == secondMin)
                .Sum(s => s.RequiredSocialSharing ?? 0);




            // Console.WriteLine($"Sum of RequiredPost for First Min: {todayPostFirstMin}");
            // Console.WriteLine($"Sum of RequiredPost for Second Min: {todayPostSecondMin}");
        }
        else if (dayLeftList.Count == 1)
        {
            int firstMin = dayLeftList[0];

            FirstMinPost = allServices
        .Where(s => s.DayLeft == firstMin)
        .Sum(s => s.RequiredPost ?? 0);

            FirstMinReels = allServices
                .Where(s => s.DayLeft == firstMin)
                .Sum(s => s.RequiredReels ?? 0);

            FirstMinBacklink = allServices
                .Where(s => s.DayLeft == firstMin)
                .Sum(s => s.RequiredBacklink ?? 0);

            FirstMinClassified = allServices
                .Where(s => s.DayLeft == firstMin)
                .Sum(s => s.RequiredClasified ?? 0);

            FirstMinSocialSharing = allServices
                .Where(s => s.DayLeft == firstMin)
                .Sum(s => s.RequiredSocialSharing ?? 0);

            // Console.WriteLine($"Only one DayLeft value found: {firstMin}, Sum of RequiredPost: {FirstMinPost}");
        }
        else
        {
            // Console.WriteLine("No DayLeft values found.");
        }
    }

    private string GetDayLabel(int dayLeft)
    {
        DateTime targetDate = DateTime.Today.AddDays(+dayLeft);
        return dayLeft switch
        {
            0 => "Today",
            1 => "Yesterday",
            _ => $"{targetDate:dd MMM yyyy}"
        };
    }



    private (string ColorClass, int DaysLeft, int RequiredUnit) GetWorkProgressColor(
    ServicesDTO service,
    int totalUnits,
    DateTime startDate,
    int completedUnits)
    {
        if (totalUnits == 0 || service.WorkTaskDetails == null)
            return ("", 0, 0);

        var breakpoints = DateService!.GetBreakPointDates(startDate, (BillingType)service.BillingType!, totalUnits);
        var interval = DateService.GetCurrentInterval(breakpoints);
        var currentInterval = DateService.GetCurrentIntervalNumber(breakpoints);
        var unit = 0;

        if (interval == null || currentInterval == null)
            return ("", 0, 0);

        int totalWorkingDays = DateService.GetTotalDaysExcludingSundays(startDate, 30);
        int daysWorkedSoFar = DateService.GetWorkingDaysBetween(startDate, DateTime.Today);
        if (daysWorkedSoFar == 0 || totalWorkingDays == 0) return ("", 0, 0);

        DateTime intervalStart = interval.Value.Start.Date;
        DateTime intervalEnd = interval.Value.End.Date;
        int daysLeft = (intervalEnd - DateTime.Today).Days;

        if (daysLeft < 0) daysLeft = 0;

        if (IsFirstInterval(breakpoints))//first interval including first day
        {
            // Console.WriteLine("first interval");
            int intervalLength = (intervalEnd - intervalStart).Days + 1;//including first day
            int todayPosition = (DateTime.Today - intervalStart).Days + 1;//including first day
            bool isLastDay = todayPosition == intervalLength;

            if (isLastDay && currentInterval > completedUnits)
            {

                // Console.WriteLine("first interval isLastDay");
                // Console.WriteLine("currentInterval:" + currentInterval);
                // Console.WriteLine("completedUnits:" + completedUnits);
                // Console.WriteLine("first interval if ");
                return ("medium-progress-bg", daysLeft, (int)currentInterval - completedUnits);
            }
            else if (isLastDay && currentInterval <= completedUnits)
            {

                // Console.WriteLine("first interval isLastDay");
                // Console.WriteLine("currentInterval:" + currentInterval);
                // Console.WriteLine("completedUnits:" + completedUnits);
                // Console.WriteLine("first interval else if ");
                return ("", 0, 0);
            }
            else
            {
                if (currentInterval <= completedUnits)
                {
                    // Console.WriteLine("first interval else => if");
                    return ("advanced-progress-bg", daysLeft, 0);
                }
                else
                {
                    // Console.WriteLine("first interval else => else");
                    return ("", daysLeft, (int)currentInterval - completedUnits);
                }
                // Console.WriteLine("first interval else");

            }

        }

        else if (currentInterval - 1 > completedUnits)//check privious pending
        {
            // Console.WriteLine("check privious pending");
            int intervalLength = (intervalEnd - intervalStart).Days;//excluding first day
            int todayPosition = (DateTime.Today - intervalStart).Days;//excluding first day
            bool isLastDay = todayPosition == intervalLength;

            if (isLastDay)
            {
                // Console.WriteLine("check privious pending if");
                // Console.WriteLine("currentInterval:" + currentInterval);
                // Console.WriteLine("completedUnits:" + completedUnits);
                // Console.WriteLine("check privious pending if ");
                return ("low-progress-bg", daysLeft, (int)currentInterval - completedUnits); // return privious pending + today(last day) pending
            }
            else
            {
                // Console.WriteLine("check privious pending else");
                // Console.WriteLine("currentInterval:" + currentInterval);
                // Console.WriteLine("completedUnits:" + completedUnits);
                //return ((int)currentInterval - 1) - completedUnits;// return privious pending only
                // Console.WriteLine("check privious pending else ");
                return ("low-progress-bg", daysLeft, ((int)currentInterval) - completedUnits);
            }

        }

        else// regularaty check
        {
            int intervalLength = (intervalEnd - intervalStart).Days;//excluding first day
            int todayPosition = (DateTime.Today - intervalStart).Days;//excluding first day
            bool isLastDay = todayPosition == intervalLength;
            // Console.WriteLine("regularaty check");

            if (isLastDay && currentInterval > completedUnits)
            {
                // Console.WriteLine("regularaty check if");
                // Console.WriteLine("currentInterval:" + currentInterval);
                // Console.WriteLine("completedUnits:" + completedUnits);
                // Console.WriteLine("regularaty check if ");
                return ("medium-progress-bg", daysLeft, (int)currentInterval - completedUnits);

            }
            else if (isLastDay && currentInterval <= completedUnits)
            {

                // Console.WriteLine("regularaty check else if");
                // Console.WriteLine("currentInterval:" + currentInterval);
                // Console.WriteLine("completedUnits:" + completedUnits);
                // Console.WriteLine("regularaty check else if ");
                return ("", 0, 0);
            }
            else
            {
                // Console.WriteLine("regularaty check else ");
                // Console.WriteLine("regularaty check else");
                // return ("", daysLeft, (int)currentInterval - completedUnits);
                if (currentInterval <= completedUnits)
                {
                    // Console.WriteLine("regularaty check else => if");
                    return ("advanced-progress-bg", daysLeft, 0);
                }
                else
                {
                    // Console.WriteLine("regularaty check else => else");
                    return ("", daysLeft, (int)currentInterval - completedUnits);
                }

            }

        }

    }

    public bool IsFirstInterval(List<DateTime> breakpoints)
    {
        DateTime currentDate = DateTime.Today;

        if (breakpoints.Count >= 2)
        {
            DateTime start = breakpoints[0].Date;
            DateTime end = breakpoints[1].Date;
            if (currentDate >= start && currentDate <= end)
            {
                return true;
            }
        }

        return false;
    }


   



    private bool MetricMatch(WorkTaskDetailsDto w, WorkMetricType metricType)
    {
        return metricType switch
        {
            WorkMetricType.SharedPost => w.SharedPost > 0,
            WorkMetricType.CreatedReels => w.CreatedReels > 0,
            WorkMetricType.Backlink => w.Backlink > 0,
            WorkMetricType.Clasified => w.Clasified > 0,
            WorkMetricType.SocialSharing => w.SocialSharing > 0,
            _ => false
        };
    }


}